<!doctype html><html lang="zh-cn" data-palette="blue"
  >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MySQL Master Slave Docker部署例子 - 颇忒脱的技术博客</title><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="" /><meta itemprop="name" content="MySQL Master Slave Docker部署例子">
<meta itemprop="description" content=""><meta itemprop="datePublished" content="2019-06-18T17:33:31+08:00" />
<meta itemprop="dateModified" content="2019-06-18T17:33:31+08:00" />
<meta itemprop="wordCount" content="1535">
<meta itemprop="keywords" content="docker,mysql," /><meta property="og:title" content="MySQL Master Slave Docker部署例子" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/mysql-master-slave-docker-example/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-06-18T17:33:31+08:00" />
<meta property="article:modified_time" content="2019-06-18T17:33:31+08:00" /><meta property="og:site_name" content="颇忒脱的技术博客" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL Master Slave Docker部署例子"/>
<meta name="twitter:description" content=""/>
<meta name="robots" content="index, follow" /><link rel="stylesheet" href="/css/main.min.b7a6eda8d46e39a549f182cf72a9ff4f4c1d4d82c31ecc3ede0b7f4d5b26f32b.css" integrity="sha256-t6btqNRuOaVJ8YLPcqn/T0wdTYLDHsw&#43;3gt/TVsm8ys=" crossorigin="anonymous"><link rel="stylesheet" href="/css/viewer.min.3d228794bcedbbfa0412beb8fbc1ec6973202945e42af7004f742a4d7bd620ab.css" integrity="sha256-PSKHlLztu/oEEr64&#43;8HsaXMgKUXkKvcAT3QqTXvWIKs=" crossorigin="anonymous"></head>
  <body><script>const items=['mode','palette'];items.forEach(function(a){const b=localStorage.getItem('hbs-'+a);b&&document.body.parentElement.setAttribute('data-'+a,b)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><img class="logo" alt="Logo" src="/images/avatar.jpg" loading="lazy"
   width="455" height="455"
   />颇忒脱的技术博客
    </a>
    
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">设置</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">

<section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> 模式</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>

<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> 字体大小</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> 配色</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="蓝色"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="蓝灰色"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="棕色"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="青色"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="绿色"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="靛青色"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="橙色"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="粉色"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="紫色"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="红色"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="蓝绿色"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="黄色"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-arrow-left"></i></span> 返回
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> 刷新
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> 复制链接
  </a></section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>专栏
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownIndex" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>快速索引
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownIndex"><li>
              <a class="dropdown-item"
                href="/tags/go">
                Go
              </a>
            </li><li>
              <a class="dropdown-item"
                href="/tags/gc">
                GC
              </a>
            </li><li>
              <a class="dropdown-item"
                href="/tags/kernel">
                Kernel
              </a>
            </li><li>
              <a class="dropdown-item"
                href="/tags/cheatsheet">
                Cheatsheet
              </a>
            </li><li>
              <a class="dropdown-item"
                href="/tags/troubleshooting">
                排障实战记录
              </a>
            </li></ul>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>标签
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>归档
          </a>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">主页</a></li><li class="breadcrumb-item"><a href="/post/">文章</a></li><li class="breadcrumb-item active">MySQL Master Slave Docker部署例子</li></ol>
  </div>
</nav><div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    <a class="action" href="#post-copyright" role="button" aria-label="Copyright" title="Copyright">
  <i class="fas fa-fw fa-copyright"></i>
</a>
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <h1 class="card-title post-title">MySQL Master Slave Docker部署例子
</h1>
  </div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="创建于 2019-06-18 17:33:31 &#43;0800 CST。">
    2019-06-18
  </span><span class="post-reading-time">
    4 分钟阅读
  </span><span class="post-taxonomies"><a href="/tags/docker/" class="badge post-taxonomy">docker</a><a href="/tags/mysql/" class="badge post-taxonomy">mysql</a></span>
</div>
<div class="post-content mb-3"><p>本文对应代码：<a href="https://github.com/chanjarster/mysql-master-slave-docker-example" target="_blank" rel="noopener noreferrer">github</a>
</p>
<p>用Docker部署基于GTID的MySQL Master-Slave Replication例子。</p>
<h2 id="启动master">启动Master<a class="anchor ms-1" href="#启动master"><i class="fas fa-link"></i></a></h2>
<p>写一个文件<code>mysql-master.cnf</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="ln">1</span>[mysqld]
<span class="ln">2</span>server_id=1
<span class="ln">3</span>binlog_format=ROW
<span class="ln">4</span>gtid_mode=ON
<span class="ln">5</span>enforce-gtid-consistency=true
</code></pre></div><p>这个配置文件把Master的<code>server_id</code>设置为1，要注意在同一个Master-Slave集群里，<code>server_id</code>不能重复。</p>
<p>启动Master：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>docker run -d --name mysql-master <span class="se">\
</span><span class="ln">2</span><span class="se"></span>  -e <span class="nv">MYSQL_USER</span><span class="o">=</span>my_user <span class="se">\
</span><span class="ln">3</span><span class="se"></span>  -e <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>my_database <span class="se">\
</span><span class="ln">4</span><span class="se"></span>  -e <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>my_database_password <span class="se">\
</span><span class="ln">5</span><span class="se"></span>  -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>my_root_password <span class="se">\
</span><span class="ln">6</span><span class="se"></span>  -p 3307:3306 <span class="se">\
</span><span class="ln">7</span><span class="se"></span>  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/mysql-master.cnf:/etc/mysql/conf.d/mysql-master.cnf <span class="se">\
</span><span class="ln">8</span><span class="se"></span>  mysql:8.0 <span class="se">\
</span><span class="ln">9</span><span class="se"></span>  --log-bin<span class="o">=</span>my
</code></pre></div><h2 id="启动slave">启动Slave<a class="anchor ms-1" href="#启动slave"><i class="fas fa-link"></i></a></h2>
<p>写一个文件<code>mysql-slave-1.cnf</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="ln">1</span>[mysqld]
<span class="ln">2</span>server_id=2
<span class="ln">3</span>binlog_format=ROW
<span class="ln">4</span>gtid_mode=ON
<span class="ln">5</span>enforce-gtid-consistency=true
<span class="ln">6</span>read_only=ON
</code></pre></div><p>这个文件把Slave的<code>server_id</code>设置为2，如果你有多个Slave，那么得分别设置不同的<code>server_id</code>。此外，将Slave设置为<code>read_only</code>模式（这样就不能在slave上执行写操作了）。</p>
<p>启动Slave：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>docker run -d --name mysql-slave-1 <span class="se">\
</span><span class="ln">2</span><span class="se"></span>  -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>my_root_password <span class="se">\
</span><span class="ln">3</span><span class="se"></span>  -p 3308:3306 <span class="se">\
</span><span class="ln">4</span><span class="se"></span>  -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/mysql-slave-1.cnf:/etc/mysql/conf.d/mysql-slave-1.cnf <span class="se">\
</span><span class="ln">5</span><span class="se"></span>  mysql:8.0 <span class="se">\
</span><span class="ln">6</span><span class="se"></span>  --skip-log-bin <span class="se">\
</span><span class="ln">7</span><span class="se"></span>  --skip-log-slave-updates <span class="se">\
</span><span class="ln">8</span><span class="se"></span>  --skip-slave-start
</code></pre></div><h2 id="创建replication用户">创建Replication用户<a class="anchor ms-1" href="#创建replication用户"><i class="fas fa-link"></i></a></h2>
<p>到Master上创建Replication用户：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>$ docker <span class="nb">exec</span> -it mysql-master mysql -u root -p
<span class="ln">2</span>Enter password: my_root_password
<span class="ln">3</span>
<span class="ln">4</span>mysql&gt; CREATE USER <span class="s1">&#39;repl&#39;</span>@<span class="s1">&#39;%&#39;</span> IDENTIFIED BY <span class="s1">&#39;password&#39;</span><span class="p">;</span>
<span class="ln">5</span>mysql&gt; GRANT REPLICATION SLAVE ON *.* TO <span class="s1">&#39;repl&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="p">;</span>
</code></pre></div><h2 id="将slave和master关联">将Slave和Master关联<a class="anchor ms-1" href="#将slave和master关联"><i class="fas fa-link"></i></a></h2>
<p>到Slave上把自己和Master关联起来：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ docker <span class="nb">exec</span> -it mysql-slave-1 mysql -u root -p
<span class="ln"> 2</span>Enter password: my_root_password
<span class="ln"> 3</span>
<span class="ln"> 4</span>mysql&gt; CHANGE MASTER TO 
<span class="ln"> 5</span>  <span class="nv">MASTER_HOST</span><span class="o">=</span><span class="s1">&#39;192.168.101.21&#39;</span>,
<span class="ln"> 6</span>  <span class="nv">MASTER_PORT</span><span class="o">=</span>3307,
<span class="ln"> 7</span>  <span class="nv">MASTER_USER</span><span class="o">=</span><span class="s1">&#39;repl&#39;</span>,
<span class="ln"> 8</span>  <span class="nv">MASTER_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span>,
<span class="ln"> 9</span>  <span class="nv">GET_MASTER_PUBLIC_KEY</span><span class="o">=</span>1,
<span class="ln">10</span>  <span class="nv">MASTER_AUTO_POSITION</span><span class="o">=</span>1<span class="p">;</span>
</code></pre></div><p>注意<code>MASTER_HOST</code>写的是Master所在的Host的IP，<code>MASTER_PORT</code>写的是Master暴露在Host上的端口，<code>MASTER_USER</code>和<code>MASTER_PASSWORD</code>则是Replication用户的信息。</p>
<p>最后正式启动Slave：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>mysql&gt; START SLAVE<span class="p">;</span>
</code></pre></div><h2 id="验证">验证<a class="anchor ms-1" href="#验证"><i class="fas fa-link"></i></a></h2>
<p>到Slave上看看my_database是否存在：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ docker <span class="nb">exec</span> -it mysql-slave-1 mysql -u root -p
<span class="ln"> 2</span>Enter password: my_root_password
<span class="ln"> 3</span>
<span class="ln"> 4</span>mysql&gt; show databases<span class="p">;</span>
<span class="ln"> 5</span>+--------------------+
<span class="ln"> 6</span><span class="p">|</span> Database           <span class="p">|</span>
<span class="ln"> 7</span>+--------------------+
<span class="ln"> 8</span><span class="p">|</span> information_schema <span class="p">|</span>
<span class="ln"> 9</span><span class="p">|</span> my_database        <span class="p">|</span>
<span class="ln">10</span><span class="p">|</span> mysql              <span class="p">|</span>
<span class="ln">11</span><span class="p">|</span> performance_schema <span class="p">|</span>
<span class="ln">12</span><span class="p">|</span> sys                <span class="p">|</span>
<span class="ln">13</span>+--------------------+
<span class="ln">14</span><span class="m">5</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</code></pre></div><p>如果有就说明my_database从Master复制到了Slave上。</p>
<h2 id="docker-compose版本">docker-compose版本<a class="anchor ms-1" href="#docker-compose版本"><i class="fas fa-link"></i></a></h2>
<p>在<a href="https://github.com/chanjarster/mysql-master-slave-docker-example" target="_blank" rel="noopener noreferrer">github</a>
上也提供了docker-compose.yaml，操作过程和上述一致，只不过容器名字会有变化。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span><span class="c1"># 拉起Master和Slave</span>
<span class="ln">2</span>$ docker-compose -p mysql-repl up
<span class="ln">3</span><span class="c1"># 连接Master</span>
<span class="ln">4</span>$ docker <span class="nb">exec</span> -it mysql-repl_mysql-master_1 mysql -u root -p
<span class="ln">5</span><span class="c1"># 连接Slave</span>
<span class="ln">6</span>$ docker <span class="nb">exec</span> -it mysql-repl_mysql-slave_1 mysql -u root -p
</code></pre></div><p>并且<code>CHANGE MASTER TO</code>语句有所不同，使用的是Master的Service Name以及容器内端口<code>3306</code>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="ln">1</span>CHANGE MASTER TO 
<span class="ln">2</span>  <span class="nv">MASTER_HOST</span><span class="o">=</span><span class="s1">&#39;mysql-master&#39;</span>,
<span class="ln">3</span>  <span class="nv">MASTER_PORT</span><span class="o">=</span>3306,
<span class="ln">4</span>  <span class="nv">MASTER_USER</span><span class="o">=</span><span class="s1">&#39;repl&#39;</span>,
<span class="ln">5</span>  <span class="nv">MASTER_PASSWORD</span><span class="o">=</span><span class="s1">&#39;password&#39;</span>,
<span class="ln">6</span>  <span class="nv">GET_MASTER_PUBLIC_KEY</span><span class="o">=</span>1,
<span class="ln">7</span>  <span class="nv">MASTER_AUTO_POSITION</span><span class="o">=</span>1<span class="p">;</span>
</code></pre></div><h2 id="troubleshooting">Troubleshooting<a class="anchor ms-1" href="#troubleshooting"><i class="fas fa-link"></i></a></h2>
<h3 id="docker-run版本在mac上无法工作">docker run版本在Mac上无法工作<a class="anchor ms-1" href="#docker-run版本在mac上无法工作"><i class="fas fa-link"></i></a></h3>
<p>这个是因为Slave容器无法访问到Master的host。解决办法我也不知道。</p>
<h3 id="关于get_master_public_key">关于GET_MASTER_PUBLIC_KEY<a class="anchor ms-1" href="#关于get_master_public_key"><i class="fas fa-link"></i></a></h3>
<p>在做本例子时出现过Slave无法连接到Master的情况：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="ln">1</span>2019-06-19T01:34:24.361566Z 8 [System] [MY-010597] [Repl] &#39;CHANGE MASTER TO FOR CHANNEL &#39;&#39; executed&#39;. Previous state master_host=&#39;&#39;, master_port= 3306, master_log_file=&#39;&#39;, master_log_pos= 4, master_bind=&#39;&#39;. New state master_host=&#39;mysql-master&#39;, master_port= 3306, master_log_file=&#39;&#39;, master_log_pos= 4, master_bind=&#39;&#39;.
<span class="ln">2</span>2019-06-19T01:34:28.274728Z 9 [Warning] [MY-010897] [Repl] Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the &#39;START SLAVE Syntax&#39; in the MySQL Manual for more information.
<span class="ln">3</span>2019-06-19T01:34:28.330825Z 9 [ERROR] [MY-010584] [Repl] Slave I/O for channel &#39;&#39;: error connecting to master &#39;repl@mysql-master:3306&#39; - retry-time: 60  retries: 1, Error_code: MY-002061
<span class="ln">4</span>2019-06-19T01:35:28.333735Z 9 [ERROR] [MY-010584] [Repl] Slave I/O for channel &#39;&#39;: error connecting to master &#39;repl@mysql-master:3306&#39; - retry-time: 60  retries: 2, Error_code: MY-002061
<span class="ln">5</span>2019-06-19T01:36:28.335525Z 9 [ERROR] [MY-010584] [Repl] Slave I/O for channel &#39;&#39;: error connecting to master &#39;repl@mysql-master:3306&#39; - retry-time: 60  retries: 3, Error_code: MY-002061
<span class="ln">6</span>...
</code></pre></div><p>详细细节可见这个<a href="https://github.com/docker-library/mysql/issues/572" target="_blank" rel="noopener noreferrer">issue</a>
，这是因为MySQL 8默认启用了caching_sha2_password authentication plugin，issue中提到了一个办法：在启动Slave的时候添加<code>--default-auth=mysql_native_password</code>参数。不过我感觉这个不太好，查阅相关文档后发现可以在<code>CHANGE MASTER TO</code>添加<code>GET_MASTER_PUBLIC_KEY=1</code>参数来解决这个问题。</p>
<p>更多详情参考<a href="https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication" target="_blank" rel="noopener noreferrer">caching_sha2_password and Replication</a>
和<a href="https://dev.mysql.com/doc/refman/8.0/en/change-master-to.html" target="_blank" rel="noopener noreferrer">CHANGE MASTER TO Syntax</a>
。</p>
<h2 id="参考资料">参考资料<a class="anchor ms-1" href="#参考资料"><i class="fas fa-link"></i></a></h2>
<ul>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-gtids-howto.html" target="_blank" rel="noopener noreferrer">Setting Up Replication Using GTIDs</a>
</p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-options-binary-log.html" target="_blank" rel="noopener noreferrer">Binary Logging Options and Variables</a>
</p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/replication-options-slave.html" target="_blank" rel="noopener noreferrer">Replication Slave Options and Variables</a>
</p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/host-cache.html" target="_blank" rel="noopener noreferrer">DNS Lookup Optimization and the Host Cache</a>
</p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/change-master-to.html" target="_blank" rel="noopener noreferrer">CHANGE MASTER TO Syntax</a>
</p>
</li>
<li>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password-replication" target="_blank" rel="noopener noreferrer">caching_sha2_password and Replication</a>
</p>
</li>
<li>
<p><a href="https://hub.docker.com/r/bitnami/mysql" target="_blank" rel="noopener noreferrer">Bitnami MySQL Docker</a>
, Bitnami制作的MySQL镜像，支持通过环境变量来配置Master-Slave Replication，不过它不支持GTID，只支持基于Binary Log的Replication。</p>
</li>
</ul></div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly">
  <div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-left"></i>
    <a href="/post/redis/redis-sentinel-spring-boot-example/">Spring Boot配置Redis Sentinel的例子
</a>
  </div><div class="post-nav post-next">
    <a href="/post/redis/redis-cluster-node-failure-detection/">Redis Cluster节点故障探测算法笔记
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article>
<div class="post-copyright mb-3 row card component" id="post-copyright">
    <div class="card-header">
        <h2 class="card-title">版权</h2>
    </div>
    <div class="card-body"><a class="d-flex align-items-center flex-column" target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">
  <span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-nc"></i><i class="fab fa-fw fa-2x fa-creative-commons-nd"></i></span>
  CC BY-NC-ND 4.0 
</a>


    </div>
</div>
<section class="related-posts row card component">
    <div class="card-header">
      <h2 class="card-title">相关文章</h2>
    </div>
    <div class="card-body">
      <ul class="post-list"><li>
          <a href="/post/docker-image-build-strategy-for-different-version-type/">稳定与非稳定版本软件的Docker Image构建策略
</a>
          <span class="float-end post-date">2019-02-27
</span>
        </li><li>
          <a href="/post/article-review/container-isolation-gone-wrong/">Container Isolation Gone Wrong
</a>
          <span class="float-end post-date">2019-02-23
</span>
        </li><li>
          <a href="/post/article-review/another-reason-why-your-docker-containers-may-be-slow/">Another Reason Why Your Docker Containers May Be Slow
</a>
          <span class="float-end post-date">2019-02-23
</span>
        </li><li>
          <a href="/post/is-logging-to-console-slow/">为何把日志打印到控制台很慢？
</a>
          <span class="float-end post-date">2019-02-22
</span>
        </li><li>
          <a href="/post/get-name-from-within-container/">Docker容器如何获得自己的名字
</a>
          <span class="float-end post-date">2019-02-20
</span>
        </li></ul>
    </div>
  </section><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">评论</h2>
  </div>
  <div class="card-body"></div>
</div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <section class="card row text-center profile component">
  <div class="card-body">
    <div class="col-12 d-flex align-items-center justify-content-center"><img class="profile-avatar rounded-circle" alt="颇忒脱" src="/images/avatar.jpg" loading="lazy"
   width="455" height="455"
   /></div>
    <div class="col-12 profile-meta"><div class="profile-name">颇忒脱</div><nav class="social-links nav justify-content-center"><a class="nav-link social-link" target="_blank" href="https://github.com/chanjarster" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a></nav>
</div>
  </div>
</section>
  <div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">目录</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#启动master">启动Master</a></li>
    <li><a href="#启动slave">启动Slave</a></li>
    <li><a href="#创建replication用户">创建Replication用户</a></li>
    <li><a href="#将slave和master关联">将Slave和Master关联</a></li>
    <li><a href="#验证">验证</a></li>
    <li><a href="#docker-compose版本">docker-compose版本</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a>
      <ul>
        <li><a href="#docker-run版本在mac上无法工作">docker run版本在Mac上无法工作</a></li>
        <li><a href="#关于get_master_public_key">关于<code>GET_MASTER_PUBLIC_KEY</code></a></li>
      </ul>
    </li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>
  </div>
</div><section class="featured-posts row card component">
    <div class="card-header">
      <h2 class="card-title">精选文章</h2>
    </div>
    <div class="card-body">
      <ul class="post-list"><li>
          <a href="/post/mysql/index-page/">MySQL系列
</a>
        </li><li>
          <a href="/post/concurrent-programming/index-page/">并发编程系列
</a>
        </li><li>
          <a href="/post/jvm/index-page/">JVM系列
</a>
        </li></ul>
    </div>
  </section><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">最近文章</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/post/jvm/gc-log-options/">JVM - GC日志参数
</a>
      </li><li>
        <a href="/post/redis/redis-cluster-solutions-compare/">Redis集群方案对比
</a>
      </li><li>
        <a href="/post/linux/namespace/">Linux命名空间一些笔记
</a>
      </li><li>
        <a href="/post/jvm-tools/">Jps Jstat Jstack...的工作原理
</a>
      </li><li>
        <a href="/post/mysql/opt-big-transaction-lock/">SQL优化:大事务中的行锁获取超时
</a>
      </li></ul>
  </div>
</section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">标签</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/arts/" class="badge rounded post-taxonomy" title="ARTS">
            ARTS<span class="badge badge-sm text-white bg-accent ms-1">193</span></a><a href="/tags/arts-a/" class="badge rounded post-taxonomy" title="ARTS-A">
            ARTS-A<span class="badge badge-sm text-white bg-accent ms-1">125</span></a><a href="/tags/arts-t/" class="badge rounded post-taxonomy" title="ARTS-T">
            ARTS-T<span class="badge badge-sm text-white bg-accent ms-1">59</span></a><a href="/tags/jvm/" class="badge rounded post-taxonomy" title="jvm">
            jvm<span class="badge badge-sm text-white bg-accent ms-1">35</span></a><a href="/tags/k8s/" class="badge rounded post-taxonomy" title="k8s">
            k8s<span class="badge badge-sm text-white bg-accent ms-1">34</span></a><a href="/tags/mysql/" class="badge rounded post-taxonomy" title="mysql">
            mysql<span class="badge badge-sm text-white bg-accent ms-1">22</span></a><a href="/tags/troubleshooting/" class="badge rounded post-taxonomy" title="troubleshooting">
            troubleshooting<span class="badge badge-sm text-white bg-accent ms-1">21</span></a><a href="/tags/docker/" class="badge rounded post-taxonomy" title="docker">
            docker<span class="badge badge-sm text-white bg-accent ms-1">20</span></a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="badge rounded post-taxonomy" title="并发编程&#34;">
            并发编程&#34;<span class="badge badge-sm text-white bg-accent ms-1">20</span></a><a href="/tags/cheatsheet/" class="badge rounded post-taxonomy" title="cheatsheet">
            cheatsheet<span class="badge badge-sm text-white bg-accent ms-1">16</span></a><a href="/tags/java/" class="badge rounded post-taxonomy" title="java">
            java<span class="badge badge-sm text-white bg-accent ms-1">14</span></a><a href="/tags/kernel/" class="badge rounded post-taxonomy" title="kernel">
            kernel<span class="badge badge-sm text-white bg-accent ms-1">13</span></a><a href="/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" class="badge rounded post-taxonomy" title="性能调优">
            性能调优<span class="badge badge-sm text-white bg-accent ms-1">11</span></a><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="badge rounded post-taxonomy" title="微服务">
            微服务<span class="badge badge-sm text-white bg-accent ms-1">10</span></a><a href="/tags/arts-r/" class="badge rounded post-taxonomy" title="ARTS-R">
            ARTS-R<span class="badge badge-sm text-white bg-accent ms-1">9</span></a><a href="/tags/prometheus/" class="badge rounded post-taxonomy" title="prometheus">
            prometheus<span class="badge badge-sm text-white bg-accent ms-1">9</span></a><a href="/tags/go/" class="badge rounded post-taxonomy" title="go">
            go<span class="badge badge-sm text-white bg-accent ms-1">8</span></a><a href="/tags/linux/" class="badge rounded post-taxonomy" title="linux">
            linux<span class="badge badge-sm text-white bg-accent ms-1">7</span></a><a href="/tags/redis/" class="badge rounded post-taxonomy" title="redis">
            redis<span class="badge badge-sm text-white bg-accent ms-1">7</span></a><a href="/tags/gc/" class="badge rounded post-taxonomy" title="gc">
            gc<span class="badge badge-sm text-white bg-accent ms-1">6</span></a><a href="/tags/%E8%BF%90%E7%BB%B4/" class="badge rounded post-taxonomy" title="运维">
            运维<span class="badge badge-sm text-white bg-accent ms-1">6</span></a><a href="/tags/ci_cd/" class="badge rounded post-taxonomy" title="CI_CD">
            CI_CD<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/debug/" class="badge rounded post-taxonomy" title="debug">
            debug<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/interview/" class="badge rounded post-taxonomy" title="interview">
            interview<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/jmx/" class="badge rounded post-taxonomy" title="jmx">
            jmx<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="badge rounded post-taxonomy" title="分布式事务">
            分布式事务<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%97%E6%B3%95/" class="badge rounded post-taxonomy" title="分布式算法">
            分布式算法<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/%E6%94%B6%E8%97%8F%E5%A4%B9/" class="badge rounded post-taxonomy" title="收藏夹">
            收藏夹<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/openssl/" class="badge rounded post-taxonomy" title="openssl">
            openssl<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/rancher/" class="badge rounded post-taxonomy" title="rancher">
            rancher<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/tls/" class="badge rounded post-taxonomy" title="tls">
            tls<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/visualvm/" class="badge rounded post-taxonomy" title="visualvm">
            visualvm<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/%E6%97%A5%E5%BF%97/" class="badge rounded post-taxonomy" title="日志">
            日志<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/tags/classloader/" class="badge rounded post-taxonomy" title="ClassLoader">
            ClassLoader<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/ingress/" class="badge rounded post-taxonomy" title="ingress">
            ingress<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/jenkins/" class="badge rounded post-taxonomy" title="Jenkins">
            Jenkins<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/network/" class="badge rounded post-taxonomy" title="network">
            network<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/scheduling/" class="badge rounded post-taxonomy" title="scheduling">
            scheduling<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/thread/" class="badge rounded post-taxonomy" title="thread">
            thread<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/" class="badge rounded post-taxonomy" title="分布式架构">
            分布式架构<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" class="badge rounded post-taxonomy" title="高并发">
            高并发<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/tags/grafana/" class="badge rounded post-taxonomy" title="grafana">
            grafana<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/jdbc/" class="badge rounded post-taxonomy" title="JDBC">
            JDBC<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/nginx/" class="badge rounded post-taxonomy" title="nginx">
            nginx<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E5%8C%BA%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" class="badge rounded post-taxonomy" title="数据库时区那些事儿">
            数据库时区那些事儿<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/%E7%9B%91%E6%8E%A7/" class="badge rounded post-taxonomy" title="监控">
            监控<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/%E9%99%90%E6%B5%81/" class="badge rounded post-taxonomy" title="限流">
            限流<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/tags/akka/" class="badge rounded post-taxonomy" title="Akka">
            Akka<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/alertmanager/" class="badge rounded post-taxonomy" title="alertmanager">
            alertmanager<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/chrome/" class="badge rounded post-taxonomy" title="chrome">
            chrome<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/elasticsearch/" class="badge rounded post-taxonomy" title="elasticsearch">
            elasticsearch<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/etcd/" class="badge rounded post-taxonomy" title="etcd">
            etcd<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/fluentd/" class="badge rounded post-taxonomy" title="fluentd">
            fluentd<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/harbor/" class="badge rounded post-taxonomy" title="harbor">
            harbor<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/helm/" class="badge rounded post-taxonomy" title="helm">
            helm<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/hystrix/" class="badge rounded post-taxonomy" title="hystrix">
            hystrix<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/io/" class="badge rounded post-taxonomy" title="io">
            io<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/jdpa/" class="badge rounded post-taxonomy" title="jdpa">
            jdpa<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/jwt/" class="badge rounded post-taxonomy" title="jwt">
            jwt<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/kafka/" class="badge rounded post-taxonomy" title="kafka">
            kafka<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/kibana/" class="badge rounded post-taxonomy" title="kibana">
            kibana<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/mq/" class="badge rounded post-taxonomy" title="MQ">
            MQ<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/oauth/" class="badge rounded post-taxonomy" title="oauth">
            oauth<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/oracle/" class="badge rounded post-taxonomy" title="Oracle">
            Oracle<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/reactor/" class="badge rounded post-taxonomy" title="reactor">
            reactor<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/spring-boot/" class="badge rounded post-taxonomy" title="spring-boot">
            spring-boot<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/spring-cloud/" class="badge rounded post-taxonomy" title="Spring Cloud">
            Spring Cloud<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/ssl/" class="badge rounded post-taxonomy" title="ssl">
            ssl<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/tiller/" class="badge rounded post-taxonomy" title="tiller">
            tiller<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/vtable/" class="badge rounded post-taxonomy" title="vtable">
            vtable<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/%E6%95%B0%E7%A0%81/" class="badge rounded post-taxonomy" title="数码">
            数码<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="badge rounded post-taxonomy" title="消息队列">
            消息队列<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/%E7%BC%93%E5%AD%98/" class="badge rounded post-taxonomy" title="缓存">
            缓存<span class="badge badge-sm text-white bg-accent ms-1">1</span></a><a href="/tags/%E8%B0%83%E7%94%A8%E9%93%BE%E8%BF%BD%E8%B8%AA/" class="badge rounded post-taxonomy" title="调用链追踪">
            调用链追踪<span class="badge badge-sm text-white bg-accent ms-1">1</span></a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav justify-content-center mb-2"><a class="nav-link social-link" target="_blank" href="https://github.com/chanjarster" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a></nav>
<div class="copyright mb-2">
  Copyright © 2016-2022 Razon Yang. All Rights Reserved.
</div>
<div class="powered-by mb-2">
  Powered by <a href="https://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a> and the <a href="https://github.com/razonyang/hugo-theme-bootstrap" target="_blank" rel="noopener noreferrer">Bootstrap</a> theme.
</div>
<a href="https://www.netlify.com" target="_blank" rel="noopener noreferrer">
    <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51" />
</a>
</footer>
<script src="/js/main.cbf2ace5d5fcb68b11b93647393ec41735869f18f31091c0941a01dfdf417dfc.js" integrity="sha256-y/Ks5dX8tosRuTZHOT7EFzWGnxjzEJHAlBoB399Bffw=" crossorigin="anonymous" defer></script><script src="/js/icons.min.a35670f2f90c398e5ee5c8e509b428fae75aa2746854cee10b60794633076859.js" integrity="sha256-o1Zw8vkMOY5e5cjlCbQo&#43;udaonRoVM7hC2B5RjMHaFk=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/js/viewer.min.4dba52a0a790f909408b7385316651299158381686401d50ff1f04dda6476473.js" integrity="sha256-TbpSoKeQ&#43;QlAi3OFMWZRKZFYOBaGQB1Q/x8E3aZHZHM=" crossorigin="anonymous" defer></script>
</body>
</html>
