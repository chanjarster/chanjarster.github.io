<!DOCTYPE html>

<html lang="zh-cn">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>颇忒脱的技术博客</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chanjarster.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chanjarster.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chanjarster.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chanjarster.github.io/manifest.json">
    <link rel="mask-icon" href="https://chanjarster.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chanjarster.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chanjarster.github.io/">颇忒脱的技术博客</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/">Home</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/%E6%94%B6%E8%97%8F%E5%A4%B9/">Bookmarks</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/jvm/index-page">JVM</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/concurrent-programming/index-page">并发编程</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/mysql/index-page">MySQL</a>
  
    <a class="color-link nav-link" href="https://github.com/chanjarster">Works</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/">Tags</a>
  
  <a class="color-link nav-link" href="https://chanjarster.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Cracking Coding Interview - 4.7 Build Order</h1>
    
    <time>August 15, 2019</time>
    
    <div>
        <p>
        <p><strong>Build Order</strong>: You are given a list of projects and a list of dependencies (which is a list of pairs of projects, where the second project is dependent on the first project). All of a project&rsquo;s dependencies must be built before the project is. Find a build order that will allow the projects to be built. If there is no valid build order, return an error.</p>
<p>EXAMPLE</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">Input:
projects:      a, b, c, d, e, f
dependencies: (a, d), (f, b), (b, d), (f, a), (d, c) 
Output:        f, e, a, b, d, c
</code></pre></div><p>Hints: #26, #47, #60, #85, #125, #133</p>
<h2 id="解法1有bug">解法1（有bug）</h2>
<p>这个题目可以认为是一张有向不循环的图，我们可以利用dependencies信息构建一个图，然后利用BFS（广度优先）的方法遍历这张图。</p>
<p>这张图的合法性其实在于是否出现循环，我们可以在遍历的时候判断是否某个节点出现两次来判断。</p>
<p>构建图的难点：</p>
<ol>
<li>如何确定root节点</li>
<li>如何添加边</li>
</ol>
<p>顺带一提，root节点不只1个，例子中f和e都是root节点</p>
<p>确定root节点的方式比较简单，如果这个节点没有指向它的边，那么它就是root</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Node</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span> project<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> referenced<span style="color:#f92672">;</span> <span style="color:#75715e">// 是否有边指向它自己
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> adjacents <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> marked<span style="color:#f92672">;</span>     <span style="color:#75715e">// BFS时用
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Dependency</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span> from<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span> to<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">buildOrder</span><span style="color:#f92672">(</span><span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> projects<span style="color:#f92672">,</span> Dependency<span style="color:#f92672">[]</span> dependencies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> nodes <span style="color:#f92672">=</span> buildNodes<span style="color:#f92672">(</span>projects<span style="color:#f92672">);</span>
  buildGraph<span style="color:#f92672">(</span>nodes<span style="color:#f92672">,</span> dependencies<span style="color:#f92672">);</span>
  List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> roots <span style="color:#f92672">=</span> findRoots<span style="color:#f92672">(</span>nodes<span style="color:#f92672">);</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>roots<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;circular dependencies&#34;</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> bfsTraverse<span style="color:#f92672">(</span>roots<span style="color:#f92672">,</span> projects<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// O(n)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">buildNodes</span><span style="color:#f92672">(</span><span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> res <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">char</span> p <span style="color:#f92672">:</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    res<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Node<span style="color:#f92672">(</span>p<span style="color:#f92672">));</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> res<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// O(n)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildGraph</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> nodes<span style="color:#f92672">,</span> Dependency<span style="color:#f92672">[]</span> dependencies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  Map<span style="color:#f92672">&lt;</span>Char<span style="color:#f92672">,</span> Node<span style="color:#f92672">&gt;</span> nodeMap <span style="color:#f92672">=</span> buildNodeMap<span style="color:#f92672">(</span>nodes<span style="color:#f92672">);</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Dependency dep <span style="color:#f92672">:</span> dependencies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Node from <span style="color:#f92672">=</span> nodeMap<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>dep<span style="color:#f92672">.</span><span style="color:#a6e22e">from</span><span style="color:#f92672">);</span>
    Node to <span style="color:#f92672">=</span> nodeMap<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>dep<span style="color:#f92672">.</span><span style="color:#a6e22e">to</span><span style="color:#f92672">);</span>
    to<span style="color:#f92672">.</span><span style="color:#a6e22e">referenced</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
    from<span style="color:#f92672">.</span><span style="color:#a6e22e">adjacents</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>to<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// O(n)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findRoots</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> nodes<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> res <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Node n <span style="color:#f92672">:</span> nodes<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>n<span style="color:#f92672">.</span><span style="color:#a6e22e">referenced</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      res<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>n<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> res<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// 如果每个节点指向所有其他节点，那么复杂度是O(n^2)
</span><span style="color:#75715e">// 如果图退化为链表，那么复杂度是O(n)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">bfsTraverse</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> nodes<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> total<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> current <span style="color:#f92672">=</span> nodes<span style="color:#f92672">;</span>  
  <span style="color:#66d9ef">char</span><span style="color:#f92672">[]</span> res <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">[</span>total<span style="color:#f92672">];</span>
  <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">while</span> <span style="color:#f92672">(!</span>current<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> next <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Node n <span style="color:#f92672">:</span> current<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      res<span style="color:#f92672">[</span>index<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> n<span style="color:#f92672">.</span><span style="color:#a6e22e">project</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n<span style="color:#f92672">.</span><span style="color:#a6e22e">marked</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;circular dependency: &#34;</span> <span style="color:#f92672">+</span> res<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>
      n<span style="color:#f92672">.</span><span style="color:#a6e22e">marked</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
      <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Node a <span style="color:#f92672">:</span> node<span style="color:#f92672">.</span><span style="color:#a6e22e">adjacents</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        next<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>a<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    current <span style="color:#f92672">=</span> next<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> res<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>如果遇到下面这种情况（都是从上往下的箭头），解法1存在bug：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">      f
     /|\
    c | d
     \|/|
      a |
      |/
      e
</code></pre></div><p>正确的顺序应该是f、c、d、a、e，但是解法1采用广度优先，因此会变成f、c、a、d、e。造成这个错误的原因是没有判断某个节点的所有父节点是否都构建过了</p>
<h2 id="解法2">解法2</h2>
<p>A -&gt; B 的意思是 B 依赖 A</p>
<ol>
<li>找不依赖别人的节点，先构建它们</li>
<li>删掉它们到下级节点对它们的依赖（因为已经构建过了，那么这个依赖可以不需要了）</li>
<li>在它们的下级节点里重复1、2步骤</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Graph</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Project<span style="color:#f92672">&gt;</span> projectMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> nodes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addProject</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>projectMap<span style="color:#f92672">.</span><span style="color:#a6e22e">containsKey</span><span style="color:#f92672">(</span>name<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      Project p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Project<span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
      nodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
      nodes<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> p<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addEdge</span><span style="color:#f92672">(</span>Edge edge<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Project from <span style="color:#f92672">=</span> nodes<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>edge<span style="color:#f92672">.</span><span style="color:#a6e22e">from</span><span style="color:#f92672">);</span>
    Project to <span style="color:#f92672">=</span> nodes<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>edge<span style="color:#f92672">.</span><span style="color:#a6e22e">to</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>from <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> to <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    from<span style="color:#f92672">.</span><span style="color:#a6e22e">addNeighbor</span><span style="color:#f92672">(</span>to<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getNodes</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#f92672">...</span> <span style="color:#f92672">};</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Project</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Project<span style="color:#f92672">&gt;</span> projectMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> neighbors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> deps <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>  <span style="color:#75715e">// 自己依赖多少个其他项目
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Project</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addNeighbor</span><span style="color:#f92672">(</span>Project p<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>projectMap<span style="color:#f92672">.</span><span style="color:#a6e22e">containsKey</span><span style="color:#f92672">(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      projectMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">,</span> p<span style="color:#f92672">);</span>
      neighbors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
      p<span style="color:#f92672">.</span><span style="color:#a6e22e">incrementDeps</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">incrementDeps</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">deps</span><span style="color:#f92672">++;</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">decrementDeps</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">deps</span><span style="color:#f92672">--;</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getNeighbors</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#f92672">...</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Edge</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">private</span> String from<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">private</span> String to<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> Project<span style="color:#f92672">[]</span> <span style="color:#a6e22e">buildOrder</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> projectNames<span style="color:#f92672">,</span> Edge<span style="color:#f92672">[]</span> edges<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  Graph graph <span style="color:#f92672">=</span> buildGraph<span style="color:#f92672">(</span>projectNames<span style="color:#f92672">);</span>
  buildEdges<span style="color:#f92672">(</span>graph<span style="color:#f92672">,</span> edges<span style="color:#f92672">);</span> 
  
  Project<span style="color:#f92672">[]</span> order <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Project<span style="color:#f92672">[</span>projects<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">];</span>
  <span style="color:#66d9ef">int</span> end <span style="color:#f92672">=</span> projectOrder<span style="color:#f92672">(</span>order<span style="color:#f92672">,</span> projects<span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
  <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>index <span style="color:#f92672">&lt;</span> order<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Project current <span style="color:#f92672">=</span> order<span style="color:#f92672">[</span>index<span style="color:#f92672">];</span>
    <span style="color:#75715e">/* We have a circular dependency since there are no remaining projects with
</span><span style="color:#75715e">     * zero dependencies. */</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project c <span style="color:#f92672">:</span> current<span style="color:#f92672">.</span><span style="color:#a6e22e">adjacents</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      c<span style="color:#f92672">.</span><span style="color:#a6e22e">decrementDeps</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    end <span style="color:#f92672">=</span> projectOrder<span style="color:#f92672">(</span>order<span style="color:#f92672">,</span> current<span style="color:#f92672">.</span><span style="color:#a6e22e">adjacents</span><span style="color:#f92672">,</span> end<span style="color:#f92672">);</span>
    index<span style="color:#f92672">++;</span>
  <span style="color:#f92672">}</span>
  
  <span style="color:#66d9ef">return</span> order<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">projectOrder</span><span style="color:#f92672">(</span>Project<span style="color:#f92672">[]</span> projectOrder<span style="color:#f92672">,</span> List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> projects<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> end<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project p <span style="color:#f92672">:</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>p<span style="color:#f92672">.</span><span style="color:#a6e22e">deps</span> <span style="color:#f92672">==</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      projectOrder<span style="color:#f92672">[</span>end<span style="color:#f92672">++]</span> <span style="color:#f92672">=</span> p<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> end<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>时间复杂度：O(P+D)，P是项目数，D是依赖数（在构建依赖的时候所用的循环）。</p>
<h2 id="解法3">解法3</h2>
<p>解法2只能发现有循环依赖，无法告诉循环到底是什么。</p>
<p>采用深度优先的方法（DFS）来做。</p>
<ol>
<li>构建链条的是这样的：parent parent -&gt; parent -&gt; leaf（叶子节点，不被别人依赖的项目）</li>
<li>每次构建的时候都是把parent插入到child之前。</li>
<li>在处理这个节点前做一个标记，表示正在处理，当处理一个节点的时候发现它正在处理，那么就说明它处于一个循环中。</li>
<li>当发现这个节点已经处理过了，那么就跳过。</li>
</ol>
<p>可以从任意节点开始处理，因为第4点保证了不会重复处理，第2点则保证了parent肯定在child之前。</p>
<p>看这个例子（所有箭头都是从上往下）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">      f         d
     /|\        |
    c | b       g
     \|/|\
      a | h
      |/
      e
</code></pre></div><p>比如我们先处理b：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">DFS(b)
  DFS(h)
    build order = ..., h
  DFS(a)
    DFS(e)
      build order = ..., e, h
    build order = ..., a, e, h
  build order = ..., b, a, e, h
</code></pre></div><p>然后我们处理f：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-txt" data-lang="txt">build order = ..., b, a, e, h
DFS(f)
  DFS(c)
    DFS(a) skip
    build order = ..., c, b, a, e, h
  DFS(a) skip
  DFS(B) skip
  build order = ..., f, c, b, a, e, h
</code></pre></div><p>代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Project</span> <span style="color:#f92672">{</span>
  String name<span style="color:#f92672">;</span>
  List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> adjacents <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildOrder</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  
  LinkedList<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> order <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project p <span style="color:#f92672">:</span> projects<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    buildOrder<span style="color:#f92672">(</span>p<span style="color:#f92672">,</span> order<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">return</span> order<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildOrder</span><span style="color:#f92672">(</span>Project project<span style="color:#f92672">,</span> LinkedList<span style="color:#f92672">&lt;</span>Project<span style="color:#f92672">&gt;</span> order<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isVisiting</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// 发现循环依赖
</span><span style="color:#75715e"></span>    order<span style="color:#f92672">.</span><span style="color:#a6e22e">insertFirst</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Cyclic depedencies: &#34;</span> <span style="color:#f92672">+</span> order<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>project<span style="color:#f92672">.</span><span style="color:#a6e22e">isCompleted</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// 该项目已经处理过了
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
  <span style="color:#f92672">}</span>
  project<span style="color:#f92672">.</span><span style="color:#a6e22e">isVisiting</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Project c <span style="color:#f92672">:</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">adjacents</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    buildOrder<span style="color:#f92672">(</span>c<span style="color:#f92672">,</span> order<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  order<span style="color:#f92672">.</span><span style="color:#a6e22e">insertFirst</span><span style="color:#f92672">(</span>project<span style="color:#f92672">);</span>
  project<span style="color:#f92672">.</span><span style="color:#a6e22e">isFinished</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div>
        </p>
    </div>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://chanjarster.github.io/tags/arts">#ARTS</a>
        
            <a class="tag" href="https://chanjarster.github.io/tags/arts-a">#ARTS-A</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>