<!DOCTYPE html>

<html lang="zh-cn">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>颇忒脱的技术博客</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chanjarster.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chanjarster.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chanjarster.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chanjarster.github.io/manifest.json">
    <link rel="mask-icon" href="https://chanjarster.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chanjarster.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chanjarster.github.io/">颇忒脱的技术博客</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/">Home</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/%E6%94%B6%E8%97%8F%E5%A4%B9/">Bookmarks</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/jvm/index-page">JVM</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/concurrent-programming/index-page">并发编程</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/mysql/index-page">MySQL</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/go/">Go</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/gc/">GC</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/kernel/">Kernel</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/cheatsheet/">Cheat sheet</a>
  
    <a class="color-link nav-link" href="https://github.com/chanjarster">Works</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/">Tags</a>
  
  <a class="color-link nav-link" href="https://chanjarster.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Coding集成Jenkins流水账</h1>
    
    <time>November 29, 2018</time>
    
    <div>
        <p>
        <p>Coding集成Jenkins流水账。</p>
<p>本文有以下假设和要求：</p>
<ol>
<li>你的项目源代码的根目录已经存在Jenkinsfile</li>
<li>你的项目是一个Maven项目</li>
<li>你的Jenkins能够从公网访问</li>
</ol>
<p>本文参考自官方文档<a href="https://open.coding.net/ci/jenkins/">使用Jenkins构建Coding项目</a></p>
<h1 id="jenkins新建文件夹">【Jenkins】新建文件夹</h1>
<p><img src="1-new-folder-1.png" alt=""><img src="1-new-folder-2.png" alt=""><img src="1-new-folder-3.png" alt=""></p>
<h1 id="jenkins配置ssh-key-pair">【Jenkins】配置SSH key pair</h1>
<p>运行下列命令生成SSH key pair，生成两个文件<code>deploykey</code>和<code>deploykey.pub</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh-keygen -f deploykey
</code></pre></div><p>进入刚刚创建的文件夹，按下图添加SSH Username with private key凭据：</p>
<p><img src="2-ssh-key-1.png" alt="">
<img src="2-ssh-key-2.png" alt=""></p>
<p>把<code>deploykey</code>的内容贴到下面这个页面里：
<img src="2-ssh-key-3.png" alt=""></p>
<p>把<code>deploykey.pub</code>的内容贴到Coding项目的部署公钥里：
<img src="2-ssh-key-4.png" alt=""></p>
<h1 id="jenkins配置maven-settingsxml">【Jenkins】配置Maven settings.xml</h1>
<p>根据<a href="../jenkins-pipeline/#%E9%85%8D%E7%BD%AEmaven-settings-xml">创建Jenkins Pipeline流水账 - 配置Maven settings.xml</a>操作</p>
<h1 id="coding创建个人访问令牌">【Coding】创建个人访问令牌</h1>
<p><img src="3-personal-token-1.png" alt=""><img src="3-personal-token-2.png" alt=""></p>
<p>把令牌复制下来，注意这个页面是你能够复制令牌的唯一一次机会，如果把这个页面关了，那只能重新创建令牌了：
<img src="3-personal-token-3.png" alt=""></p>
<h1 id="jenkins新建流水线">【Jenkins】新建流水线</h1>
<p>到刚才创建的文件夹里创建流水线：</p>
<p><img src="4-new-pipeline-1.png" alt="">
<img src="4-new-pipeline-2.png" alt=""></p>
<p>做这么几件事情：</p>
<ol>
<li>把Webhook地址复制下来</li>
<li>设置Webhook令牌，这个相当于密码，你自己随便输。</li>
<li>把之前创建的个人访问令牌贴到【访问令牌】输入框。</li>
<li>然后按照下图方式配置。
<img src="5-config-pipeline-1.png" alt=""></li>
</ol>
<p>点击下图所示问号能看到以下帮助文档，注意我们是私有项目看红框内容：
<img src="5-config-pipeline-2.png" alt=""></p>
<p>在Pipeline部分配置仓库：</p>
<ol>
<li>Credential使用之前创建的SSH key</li>
<li>Name和Refspec是根据前面帮助文档里要求的填写的
<img src="5-config-pipeline-3.png" alt=""></li>
</ol>
<p>在Branches to build里添加两项：</p>
<ol>
<li><code>refs/remotes/origin/*</code></li>
<li><code>refs/remotes/origin/merge/*</code></li>
</ol>
<p>其实这两个值是帮助文档里提到的而来，注意两个refspec里冒号后面的部分：</p>
<blockquote>
<p>如果是私有项目, 设置 refspec 为 <code>+refs/heads/*:refs/remotes/origin/* +refs/merge/*/MERGE:refs/remotes/origin/merge/*</code>
<img src="5-config-pipeline-4.png" alt=""></p>
</blockquote>
<p>添加两个Additional Behaviours：
<img src="5-config-pipeline-5.png" alt=""></p>
<p>去掉Lightweight checkout的勾：
<img src="5-config-pipeline-6.png" alt=""></p>
<p>在Pipeline Maven Configuration部分选择刚才创建的Maven settings.xml：</p>
<p><img src="../jenkins-pipeline/config-pipeline-4.png" alt=""></p>
<h1 id="coding配置webhook">【Coding】配置Webhook</h1>
<p>到项目的 设置 -&gt; WebHook 页面，添加Webhook：</p>
<p><img src="6-coding-webhook-1.png" alt=""></p>
<p>按下图配置：
<img src="6-coding-webhook-2.png" alt=""></p>
<h1 id="效果">效果</h1>
<p>至此大功告成。</p>
<p>你可以通过提交commit的方式触发Jenkins构建，然后可以在项目的这个页面看到构建结果：</p>
<p><img src="7-final-1.png" alt=""><img src="7-final-2.png" alt=""></p>
<p>你也可以创建合并请求，Coding会触发Jenkins构建并且把构建结果添加到合并请求里：
<img src="7-final-3.png" alt=""></p>
        </p>
    </div>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://chanjarster.github.io/tags/ci_cd">#CI_CD</a>
        
            <a class="tag" href="https://chanjarster.github.io/tags/jenkins">#Jenkins</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>