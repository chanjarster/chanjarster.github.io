<!DOCTYPE html>

<html lang="zh-cn">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>颇忒脱的技术博客</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chanjarster.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chanjarster.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chanjarster.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chanjarster.github.io/manifest.json">
    <link rel="mask-icon" href="https://chanjarster.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chanjarster.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chanjarster.github.io/">颇忒脱的技术博客</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/">Home</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/%E6%94%B6%E8%97%8F%E5%A4%B9/">Bookmarks</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/concurrent-programming/index-page">并发编程</a>
  
    <a class="color-link nav-link" href="">MySQL</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/go/">Go</a>
  
    <a class="color-link nav-link" href="https://github.com/chanjarster">Works</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/">Tags</a>
  
  <a class="color-link nav-link" href="https://chanjarster.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">JVM - 运行时数据区域</h1>
    
    <time>February 17, 2019</time>
    
    <div>
        <p>
        <h2 id="概览">概览</h2>
<p><img src="area-relations.png" alt=""></p>
<h2 id="详细">详细</h2>
<h3 id="pc寄存器pc-register">PC寄存器（PC Register）</h3>
<p>所属：线程</p>
<p>创建：创建线程时创建</p>
<p>作用：记录线程执行到哪个JVM指令了</p>
<p>存储：含有当前线程所正在执行JVM指令的地址。如果正在执行的是本地方法，则行为是未定义的</p>
<h3 id="java虚拟机栈java-virtual-machine-stack">Java虚拟机栈（Java Virtual Machine Stack）</h3>
<p>所属：线程</p>
<p>创建：创建线程时创建</p>
<p>作用：Java虚拟机栈和C语言的栈类似，存储了本地变量（local variables）、部分结果（partial results）、在方法的调用和返回中起作用</p>
<p>存储：存储栈帧（Frame）</p>
<p>尺寸：固定尺寸或动态扩展缩减</p>
<p>空间：不要求空间连续</p>
<h3 id="本地方法栈native-method-stack">本地方法栈（Native Method Stack）</h3>
<p>所属：线程</p>
<p>创建：创建线程时创建</p>
<p>作用：如果JVM实现支持<code>native</code>方法，则需要本地方法栈；本地方法栈就是传统栈（就是C栈）</p>
<p>尺寸：固定尺寸或动态扩展缩减</p>
<p>空间：不要求空间连续</p>
<h3 id="堆heap">堆（Heap）</h3>
<p>所属：JVM</p>
<p>创建：JVM启动时创建</p>
<p>作用：被JVM所有线程所共享；所有类的实例和数组都是在这里分配的</p>
<p>存储：类的实例</p>
<p>尺寸：固定尺寸或动态扩展缩减；对象回收工作由GC负责，JVM Spec不规定如何实现GC</p>
<p>空间：不要求空间连续</p>
<h3 id="方法区method-area">方法区（Method Area）</h3>
<p>所属：</p>
<ul>
<li>堆，虽然在堆中，但有个别名Non-heap</li>
<li>有些JVM实现选择不GC也不压缩方法区</li>
<li>该区域比较难以回收，因此有些时候被称为PermGen</li>
</ul>
<p>创建：JVM启动时创建</p>
<p>作用：方法区被JVM所有线程所共享</p>
<p>存储：</p>
<ul>
<li>类信息、常量、静态变量、JIT编译结果等</li>
<li>每个类的结构，如运行时常量池（run-time constant pool）、字段和方法数据</li>
<li>方法和构造函数的代码，包括类初始化代码块（静态代码块<code>&lt;clinit&gt;</code>）和类实例初始化代码块（<code>&lt;init&gt;</code>）和接口初始化代码这些特殊方法</li>
</ul>
<p>尺寸：固定尺寸或动态扩展缩减</p>
<p>空间：不要求空间连续</p>
<h3 id="运行时常量池run-time-constant-pool">运行时常量池（Run-time constant pool）</h3>
<p>所属：方法区</p>
<p>创建：类加载的【创建与加载】阶段</p>
<p>作用：类似于传统语言的符号表（symbol table），但是存储的数据范围比传统符号表要广</p>
<p>存储：</p>
<ul>
<li>各种常量，范围从编译时所知的数字字面值（numeric literals）到运行时所必须解析（resolve）的方法与字段的引用</li>
<li>类的版本、字段、方法、接口</li>
</ul>
<h3 id="栈帧frame">栈帧（Frame）</h3>
<p>所属：Java虚拟机栈</p>
<p>创建/销毁：</p>
<ul>
<li>调用方法时创建</li>
<li>方法调用结束时销毁，正常结束/异常技术都会销毁</li>
</ul>
<p>作用：</p>
<ul>
<li>存储数据和部分结果</li>
<li>执行动态链接（dynamic linking）</li>
<li>为方法返回值（return values for methods）</li>
<li>派发异常（dispatch exceptions）</li>
<li>给定线程，有且仅有一个活动栈帧，这个栈帧代表了正在运行的方法</li>
</ul>
<p>存储：每个帧有用自己的本地变量数组（local variable array）、操作数栈（operand stack）、一个指向当前运行方法所在类的运行时常量池的引用</p>
<p>尺寸：</p>
<ul>
<li>每个方法的本地变量数组长度和操作数栈的大小在编译时就已经确定下来了</li>
<li>因此它的尺寸仅依赖于JVM的实现以及这两个数据结构所需要的内存</li>
</ul>
<h3 id="直接内存">直接内存</h3>
<p>所属：</p>
<ul>
<li>不属于JVM，JVM也不管</li>
<li>操作系统，所以被称为Direct Memory，或者堆外内存</li>
</ul>
<p>作用：直接操作系统分配，减少Java堆和Native堆的数据Copy，提升效率</p>
<p>创建：使用Native函数直接分配</p>
<h3 id="脑图">脑图</h3>
<p><img src="areas.png" alt=""></p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5">Java Virtual Machine Specification | 2.5. Run-Time Data Areas</a></li>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html#jvms-5.3">Java Virtual Machine Specification | 5.3. Creation and Loading</a></li>
<li><a href="https://time.geekbang.org/column/article/11289">极客时间 | 深入拆解 Java 虚拟机 | 01 | Java代码是怎么运行的？</a></li>
</ul>
        </p>
    </div>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://chanjarster.github.io/tags/arts">#ARTS</a>
        
            <a class="tag" href="https://chanjarster.github.io/tags/arts-t">#ARTS-T</a>
        
            <a class="tag" href="https://chanjarster.github.io/tags/jvm">#JVM</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>