<!DOCTYPE html>

<html lang="zh-cn">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>颇忒脱的技术博客</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chanjarster.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chanjarster.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chanjarster.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chanjarster.github.io/manifest.json">
    <link rel="mask-icon" href="https://chanjarster.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chanjarster.github.io/css/main.min.03322cbe6bddfc28e7b17b84bc5446282a510b14b57be3371ba1f68ef1ab9ce8.css"/>

    
    
    

    
    
 
    
    
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chanjarster.github.io/">颇忒脱的技术博客</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/">Home</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/%E6%94%B6%E8%97%8F%E5%A4%B9/">Bookmarks</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/jvm/index-page">JVM</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/concurrent-programming/index-page">并发编程</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/post/mysql/index-page">MySQL</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/go/">Go</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/gc/">GC</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/kernel/">Kernel</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/cheatsheet/">Cheatsheet</a>
  
    <a class="color-link nav-link" href="https://github.com/chanjarster">Works</a>
  
    <a class="color-link nav-link" href="https://chanjarster.github.io/tags/">Tags</a>
  
  <a class="color-link nav-link" href="https://chanjarster.github.io/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">多种认证、授权模型的比较</h1>
    
    <time>August 22, 2018</time>
    
    <div>
        <p>
        <p>本文比较了OAuth2.0的几种模式以及基于Session和JWT的认证模式。</p>
<p>本文主要列举在如今前后端分离、手机App大行其道的现状下，用户认证、授权的几种做法及对比。</p>
<p>PS. 本文假设你已经理解了各种认证模式的具体细节。</p>
<h2 id="oauth20的几种模式">OAuth2.0的几种模式</h2>
<p>OAuth2.0是一个被广泛采用的事实标准，它同时包含认证和授权两种模式，我们来看一下它有几种模式：</p>
<table>
<thead>
<tr>
<th>Grant type</th>
<th>Client owner</th>
<th>User context?</th>
<th>Client type</th>
<th>App type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization Code</td>
<td>Third-party</td>
<td>Y</td>
<td>confidential</td>
<td>Web app</td>
</tr>
<tr>
<td>Authorization Code, without client secret</td>
<td>Third-party</td>
<td>Y</td>
<td>public</td>
<td>User-agent app</td>
</tr>
<tr>
<td>Authorization Code, without client secret, with PKCE</td>
<td>Third-party</td>
<td>Y</td>
<td>public</td>
<td>Native app</td>
</tr>
<tr>
<td>OAuth2 Implicit(deprecated)</td>
<td>Third-party</td>
<td>Y</td>
<td>public</td>
<td>User-agent app, Native app</td>
</tr>
<tr>
<td>Password</td>
<td>First-party</td>
<td>Y</td>
<td>both</td>
<td>Web app, User-agent app, Native app</td>
</tr>
<tr>
<td>Client Credentials</td>
<td>Third-party</td>
<td>N</td>
<td>confidential</td>
<td>Web app</td>
</tr>
</tbody>
</table>
<p>名词定义：</p>
<ul>
<li><strong>User</strong>: 自然人。</li>
<li><strong>Client</strong>: 索要Authorization Code和Access Token的程序。</li>
</ul>
<p>Client owner:</p>
<ul>
<li><strong>First-party</strong>: 第一方client，即client开发者/厂商和Resource Server是同一个人/厂商。</li>
<li><strong>Third-party</strong>: 第三方client，即client开发者/厂商和Resource Server不是同一个人/厂商。OAuth 2.0主要解决的是第三方client的授权问题。</li>
</ul>
<p>User context:</p>
<ul>
<li><strong>Y</strong>: 代表被授权的资源是和当前User相关的。</li>
<li><strong>N</strong>: 代表被授权的资源是和Client相关的。</li>
</ul>
<p>Client type:</p>
<ul>
<li><strong>Confidential</strong>: 这类Client和Authorization Server/Resource Server的通信是秘密进行的。</li>
<li><strong>Public</strong>: 这类Client和Authorization Server/Resource Server的通信是公开进行的。</li>
</ul>
<p>App type:</p>
<ul>
<li><strong>web app</strong>: 这类App的代码在服务器上执行，用户通过User-Agent（浏览器）下载App渲染的HTML页面，并与之交互。比如，传统的MVC应用。</li>
<li><strong>user-agent app</strong>: 这类App的代码是直接下载到User-Agent（浏览器）里执行的。比如，前后端分离App、SPA。</li>
<li><strong>native app</strong>: 这类App安装在用户的设备上，可以认为这类App内部存储的credential信息是有可能被提取的。比如，手机App、桌面App。</li>
</ul>
<h2 id="仅做认证的模式">仅做认证的模式</h2>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Client belong</th>
<th>User Context</th>
<th>App type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Session</td>
<td>First-party</td>
<td>Y</td>
<td>Web app</td>
</tr>
<tr>
<td>SSO</td>
<td>First-party</td>
<td>Y</td>
<td>Web app</td>
</tr>
<tr>
<td>JWT</td>
<td>First-party</td>
<td>Y</td>
<td>Web app, User-agent app, Native app</td>
</tr>
</tbody>
</table>
<p>详细说明以上三种模式：</p>
<p><strong>Session模式</strong>: 就是我们传统的Web app所使用的技术，用户输入账号和密码登录系统，服务端返回一个名字叫做<code>SESSIONID</code>的<code>Cookie</code>，之后User-agent和服务端每次交互都会携带这个<code>Cookie</code>，通过这种方式来做到用户登录状态的保持。</p>
<p><strong>SSO模式</strong>: 其实是<strong>Session模式</strong>的变种，只不过把认证从<strong>Session模式</strong>的本地认证变成了利用<strong>SSO服务器</strong>做认证。已知SSO类型有：CAS、SAML。</p>
<p><strong>JWT模式</strong>: 它和<strong>Session模式</strong>的区别在于:</p>
<ol>
<li>用户会话信息不通过<code>Cookie</code>携带，而是放在<code>Header</code>里，这个信息我们叫做<code>Token</code>。</li>
<li><code>Token</code>里包含了加密的、不可篡改的当前登录用户的信息，<code>SESSIONID</code>只是一个代号，是没有这个信息的。</li>
<li>服务端可以做到无状态，因为用户信息在<code>Token</code>里已经存在，再也不需要维护Session了。</li>
</ol>
<p><strong>JWT模式</strong>可以使用SSO吗？答案是可以的，但是有条件，在SSO认证流程的最后一步——获取用户信息——的通信必须是confidential的。</p>
<p>对于Web app来说只要它接入了SSO，获取用户信息的通信本来就是confidential的，它获得用户信息之后构造JWT并返回就可以了。</p>
<p>对于User-agent app和Native app来说，需要为它做一个中介Web app，这个Web app和SSO通信，然后构造JWT返回给User-agent app。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://oauth.net/2/">OAuth 2.0 official site</a></li>
<li><a href="https://www.oauth.com/">OAuth 2.0 - Written by Aaron Parecki</a></li>
<li><a href="https://jwt.io/">JWT official site</a></li>
<li><a href="https://apereo.github.io/cas/4.2.x/protocol/CAS-Protocol.html">SSO的一种 - CAS Protocol</a></li>
</ul>
        </p>
    </div>
    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="https://chanjarster.github.io/tags/oauth">#oauth</a>
        
            <a class="tag" href="https://chanjarster.github.io/tags/jwt">#jwt</a>
        
      
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chanjarster" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chanjarster.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>